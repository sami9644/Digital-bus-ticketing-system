{% extends "dashboard.html" %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-12 col-md-8 col-lg-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h3 class="card-title mb-4">Change Password</h3>
                    
                    <form id="passwordForm" action="/change/password" method="post">
                        <div class="mb-3">
                            <label class="form-label">Old Password</label>
                            <input class="form-control" type="password" name="old" required>
                        </div>

                        <hr>

                        <div class="mb-3">
                            <label class="form-label">New Password</label>
                            <input class="form-control" type="password" name="new" id="newPass" 
                                   minlength="8" required>
                            <div class="form-text">Must be at least 8 characters long.</div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Repeat New Password</label>
                            <input class="form-control" type="password" name="rep" id="repPass" required>
                            <div id="passwordError" class="invalid-feedback">
                                Passwords do not match!
                            </div>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">Update Password</button>
                        </div>
                    </form>
                    
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const passwordForm = document.getElementById('passwordForm');
    const newPass = document.getElementById('newPass');
    const repPass = document.getElementById('repPass');
    const errorMsg = document.getElementById('passwordError');

    passwordForm.addEventListener('submit', function (event) {
        // 1. Check if passwords match
        if (newPass.value !== repPass.value) {
            event.preventDefault(); // Stop form submission
            event.stopPropagation();
            
            repPass.classList.add('is-invalid'); // Show Bootstrap error style
            errorMsg.style.display = 'block';
        } else {
            repPass.classList.remove('is-invalid');
            errorMsg.style.display = 'none';
        }

        // 2. Extra strength check (Example: Check for a number)
        const hasNumber = /\d/.test(newPass.value);
        if (!hasNumber) {
            alert("Password must contain at least one number.");
            event.preventDefault();
        }
    });

    // Clear error styling as the user types
    repPass.addEventListener('input', () => {
        repPass.classList.remove('is-invalid');
        errorMsg.style.display = 'none';
    });
</script>
{% endblock %}